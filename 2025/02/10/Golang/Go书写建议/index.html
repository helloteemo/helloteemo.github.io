<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 5.4.0"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png"><link rel="icon" type="image/png" sizes="32x32" href="https://img.helloteemo.com.cn/favicon-32x32-next.ico"><link rel="icon" type="image/png" sizes="16x16" href="https://img.helloteemo.com.cn/favicon-16x16-next.ico"><link rel="mask-icon" href="/images/logo.svg" color="#222"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><meta name="google-site-verification" content="cRV2yI-DzG-36rSY_KkaZUfbhwP44Pcb00CdmjipHYU"><meta name="baidu-site-verification" content="code-nKoW4lrjrO"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css"><script id="hexo-configurations">var NexT=window.NexT||{},CONFIG={hostname:"helloteemo.github.io",root:"/",scheme:"Pisces",version:"7.8.0",exturl:!1,sidebar:{position:"left",display:"post",padding:18,offset:12,onmobile:!1},copycode:{enable:!0,show_result:!0,style:"flat"},back2top:{enable:!0,sidebar:!0,scrollpercent:!0},bookmark:{enable:!0,color:"#222",save:"auto"},fancybox:!1,mediumzoom:!1,lazyload:!1,pangu:!1,comments:{style:"tabs",active:null,storage:!0,lazyload:!1,nav:null},algolia:{hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}},localsearch:{enable:!0,trigger:"auto",top_n_per_article:1,unescape:!1,preload:!1},motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}},path:"search.xml"}</script><meta name="description" content="类似于Java开发手册之类的"><meta property="og:type" content="article"><meta property="og:title" content="Go书写建议"><meta property="og:url" content="https://helloteemo.github.io/2025/02/10/Golang/Go%E4%B9%A6%E5%86%99%E5%BB%BA%E8%AE%AE/index.html"><meta property="og:site_name" content="芒果zzZ"><meta property="og:description" content="类似于Java开发手册之类的"><meta property="og:locale" content="zh_CN"><meta property="article:published_time" content="2025-02-10T10:26:41.995Z"><meta property="article:modified_time" content="2025-02-10T10:26:41.995Z"><meta property="article:author" content="芒果zzZ"><meta property="article:tag" content="go"><meta name="twitter:card" content="summary"><link rel="canonical" href="https://helloteemo.github.io/2025/02/10/Golang/Go%E4%B9%A6%E5%86%99%E5%BB%BA%E8%AE%AE/"><script id="page-configurations">CONFIG.page={sidebar:"",isHome:!1,isPost:!0,lang:"zh-CN"}</script><title>Go书写建议 | 芒果zzZ</title><noscript><style>.sidebar-inner,.use-motion .brand,.use-motion .collection-header,.use-motion .comments,.use-motion .menu-item,.use-motion .pagination,.use-motion .post-block,.use-motion .post-body,.use-motion .post-header{opacity:initial}.use-motion .site-subtitle,.use-motion .site-title{opacity:initial;top:initial}.use-motion .logo-line-before i{left:initial}.use-motion .logo-line-after i{right:initial}</style></noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-math@4.0.0/dist/style.css"><link rel="alternate" href="/atom.xml" title="芒果zzZ" type="application/atom+xml">
</head><body itemscope itemtype="http://schema.org/WebPage"><div class="container use-motion"><div class="headband"></div><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-container"><div class="site-nav-toggle"><div class="toggle" aria-label="切换导航栏"><span class="toggle-line toggle-line-first"></span> <span class="toggle-line toggle-line-middle"></span> <span class="toggle-line toggle-line-last"></span></div></div><div class="site-meta"><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span><h1 class="site-title">芒果zzZ</h1><span class="logo-line-after"><i></i></span></a><p class="site-subtitle" itemprop="description">Java Go</p></div><div class="site-nav-right"><div class="toggle popup-trigger"><i class="fa fa-search fa-fw fa-lg"></i></div></div></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-fw fa-home"></i>首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-fw fa-user"></i>关于</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i>标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i>分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>归档</a></li><li class="menu-item menu-item-schedule"><a href="/schedule/" rel="section"><i class="fa fa-fw fa-calendar"></i>日程表</a></li><li class="menu-item menu-item-todolist"><a href="/todolist/" rel="section"><i class="fa fa-fw fa-clipboard"></i>todolist</a></li><li class="menu-item menu-item-sitemap"><a href="/sitemap.xml" rel="section"><i class="fa fa-fw fa-sitemap"></i>站点地图</a></li><li class="menu-item menu-item-search"><a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索</a></li></ul></nav><div class="search-pop-overlay"><div class="popup search-popup"><div class="search-header"><span class="search-icon"><i class="fa fa-search"></i></span><div class="search-input-container"><input autocomplete="off" autocapitalize="off" placeholder="搜索..." spellcheck="false" type="search" class="search-input"></div><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span></div><div id="search-result"><div id="no-result"><i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i></div></div></div></div></div></header><div class="reading-progress-bar"></div><a role="button" class="book-mark-link book-mark-link-fixed"></a><main class="main"><div class="main-inner"><div class="content-wrap" style="margin-top:2%"><div class="content post posts-expand"><article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://helloteemo.github.io/2025/02/10/Golang/Go%E4%B9%A6%E5%86%99%E5%BB%BA%E8%AE%AE/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="https://img.helloteemo.com.cn/logo.png"><meta itemprop="name" content="芒果zzZ"><meta itemprop="description" content="纵有风花雪月又如何"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="芒果zzZ"></span><header class="post-header"><h1 class="post-title" itemprop="name headline">Go书写建议</h1><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i> </span><span class="post-meta-item-text">发表于</span> <time title="创建时间：2025-02-10 18:26:41" itemprop="dateCreated datePublished" datetime="2025-02-10T18:26:41+08:00">2025-02-10</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-folder-o"></i> </span><span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Golang/" itemprop="url" rel="index"><span itemprop="name">Golang</span></a> </span></span><span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-eye"></i> </span><span class="post-meta-item-text">阅读次数：</span> <span id="busuanzi_value_page_pv"></span></span><br><span class="post-meta-item" title="本文字数"><span class="post-meta-item-icon"><i class="fa fa-file-word-o"></i> </span><span class="post-meta-item-text">本文字数：</span> <span>6.3k</span> </span><span class="post-meta-item" title="阅读时长"><span class="post-meta-item-icon"><i class="fa fa-clock-o"></i> </span><span class="post-meta-item-text">阅读时长 &asymp;</span> <span>6 分钟</span></span></div></header><div class="post-body" itemprop="articleBody"><blockquote><p>类似于Java开发手册之类的</p></blockquote><span id="more"></span><h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a><strong>前言</strong></h1><p>本文中概述的一些标准都是客观性的评估，是根据场景、上下文、或者主观性的判断；</p><p>但是最重要的是，<strong>保持一致</strong>.</p><p>一致性的代码更容易维护、是更合理的、需要更少的学习成本、并且随着新的约定出现或者出现错误后更容易迁移、更新、修复 bug</p><p>相反，在一个代码库中包含多个完全不同或冲突的代码风格会导致维护成本开销、不确定性和认知偏差。所有这些都会直接导致速度降低、代码审查痛苦、而且增加 bug 数量</p><h1 id="通用"><a href="#通用" class="headerlink" title="通用"></a><strong>通用</strong></h1><h2 id="注释"><a href="#注释" class="headerlink" title="注释"></a><strong>注释</strong></h2><h3 id="强制"><a href="#强制" class="headerlink" title="强制"></a><strong>强制</strong></h3><ol><li>每一个可导出(首字母大写)的函数、名称都应该有文档注释</li><li>关键流程和关键算法都应该有注释。</li><li>一些魔法数字或者妥协而加的代码都应该有注释说明为什么需要添加</li></ol><p>注释不应该写是什么，而应该写为什么。比如说我有一段休眠代码</p><pre class="language-none"><code class="language-none">for i :&#x3D; range arr &#123;
  if i%500 &#x3D;&#x3D; 0&#123;
    &#x2F;&#x2F; 睡眠一段时间
    time.Sleep(500)
  &#125;
&#125;</code></pre><p>写 “睡眠一段时间” 这个注释是无效的，后续看代码的同学还是不清楚为什么要休眠，</p><p>但是应该写 “为了缓解服务器压力，这里等待一段时间再做逻辑” 就很清晰了</p><p><strong>Bad</strong></p><pre class="language-go" data-language="go"><code class="language-go"><span class="token keyword">func</span> <span class="token function">Complie</span><span class="token punctuation">(</span>str <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>regexp <span class="token operator">*</span>Regexp<span class="token punctuation">,</span>err <span class="token builtin">error</span><span class="token punctuation">)</span></code></pre><p><strong>Good</strong></p><pre class="language-go" data-language="go"><code class="language-go"><span class="token comment">// Complie 用于解析正则表达式并返回，如果成功，则 Regexp 对象就可用于匹配所针对的文本。</span>
<span class="token keyword">func</span> <span class="token function">Complie</span><span class="token punctuation">(</span>str <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>regexp <span class="token operator">*</span>Regexp<span class="token punctuation">,</span>err <span class="token builtin">error</span><span class="token punctuation">)</span></code></pre><h3 id="推荐"><a href="#推荐" class="headerlink" title="推荐"></a><strong>推荐</strong></h3><ol><li>修改代码的同时，注释也要相应的进行修改，尤其是参数、返回值、异常、核心逻辑等</li><li>与其“半吊子cv英文来注释，不如用中文注释把问题说清楚。专有名词与关键字保持 英文原文即可</li><li>谨慎注释掉代码。在上方详细说明，而不是简单地注释掉。如果无用，则删除。</li><li>对于注释的要求:第一、能够准确反映设计思想和代码逻辑;第二、能够描述业务含 义，使别的程序员能够迅速了解到代码背后的信息。注释是给自己看的，即使隔很长时间，也能清晰理解当时的思路，注释也是给接受人，使其能够快速接替自己的工作。</li></ol><h2 id="内存管理"><a href="#内存管理" class="headerlink" title="内存管理"></a><strong>内存管理</strong></h2><h3 id="强制-1"><a href="#强制-1" class="headerlink" title="强制"></a><strong>强制</strong></h3><h4 id="切片长度校验"><a href="#切片长度校验" class="headerlink" title="切片长度校验"></a><strong>切片长度校验</strong></h4><p>对slice进行操作时，必须判断长度是否合法，防止程序Panic</p><p><strong>Bad</strong></p><pre class="language-go" data-language="go"><code class="language-go"><span class="token keyword">func</span> <span class="token function">foo</span><span class="token punctuation">(</span>data <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token builtin">bool</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span> data<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">0</span>
<span class="token punctuation">&#125;</span></code></pre><p><strong>Good</strong></p><pre class="language-go" data-language="go"><code class="language-go"><span class="token keyword">func</span> <span class="token function">foo</span><span class="token punctuation">(</span>data <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token builtin">bool</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">if</span> data <span class="token operator">==</span> <span class="token boolean">nil</span> <span class="token operator">||</span> <span class="token function">len</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token boolean">false</span>
	<span class="token punctuation">&#125;</span>
  <span class="token keyword">return</span> data<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">0</span>
<span class="token punctuation">&#125;</span></code></pre><h4 id="nil指针判空"><a href="#nil指针判空" class="headerlink" title="nil指针判空"></a><strong>nil指针判空</strong></h4><p>进行指针操作时，需要判断该指针是否为空，防止程序Panic，<strong>在Get函数中时如果时指针引用也必须判断指针是否为空</strong>，尤其是在结构体进行Unmarshal之后</p><p><strong>Bad</strong></p><pre class="language-go" data-language="go"><code class="language-go"><span class="token keyword">func</span> <span class="token function">foo</span><span class="token punctuation">(</span>src <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">byte</span><span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">var</span> dest <span class="token operator">=</span> <span class="token function">new</span><span class="token punctuation">(</span>Data<span class="token punctuation">)</span>
  err <span class="token operator">:=</span> json<span class="token punctuation">.</span><span class="token function">Unmarshal</span><span class="token punctuation">(</span>src<span class="token punctuation">)</span>
  <span class="token keyword">if</span> err<span class="token operator">!=</span><span class="token boolean">nil</span><span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> err
  <span class="token punctuation">&#125;</span>
  <span class="token function">use</span><span class="token punctuation">(</span>dest<span class="token punctuation">.</span>Member<span class="token punctuation">.</span>UserName<span class="token punctuation">)</span> <span class="token comment">// panic</span>
  <span class="token keyword">return</span> 
<span class="token punctuation">&#125;</span></code></pre><p><strong>Good</strong></p><pre class="language-go" data-language="go"><code class="language-go"><span class="token keyword">func</span> <span class="token function">foo</span><span class="token punctuation">(</span>src <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">byte</span><span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">if</span> src <span class="token operator">==</span> <span class="token boolean">nil</span> <span class="token operator">||</span> <span class="token function">len</span><span class="token punctuation">(</span>src<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> ErrSliceIsEmpty
  <span class="token punctuation">&#125;</span>
  <span class="token keyword">var</span> dest <span class="token operator">=</span> <span class="token function">new</span><span class="token punctuation">(</span>Data<span class="token punctuation">)</span>
  err <span class="token operator">:=</span> json<span class="token punctuation">.</span><span class="token function">Unmarshal</span><span class="token punctuation">(</span>src<span class="token punctuation">)</span>
  <span class="token keyword">if</span> err<span class="token operator">!=</span><span class="token boolean">nil</span><span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> err
  <span class="token punctuation">&#125;</span>
  <span class="token keyword">if</span> dest<span class="token punctuation">.</span>Member <span class="token operator">==</span> <span class="token boolean">nil</span><span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> Err
  <span class="token punctuation">&#125;</span>
  <span class="token function">use</span><span class="token punctuation">(</span>dest<span class="token punctuation">.</span>Member<span class="token punctuation">.</span>UserName<span class="token punctuation">)</span>
  <span class="token keyword">return</span> 
<span class="token punctuation">&#125;</span></code></pre><p>Get函数中也必须判空</p><p><strong>Bad</strong></p><pre class="language-go" data-language="go"><code class="language-go"><span class="token keyword">func</span> <span class="token punctuation">(</span>m <span class="token operator">*</span>Member<span class="token punctuation">)</span> <span class="token function">UserName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">string</span><span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span> m<span class="token punctuation">.</span>UserName
<span class="token punctuation">&#125;</span></code></pre><p><strong>Good</strong></p><pre class="language-go" data-language="go"><code class="language-go"><span class="token keyword">func</span> <span class="token punctuation">(</span>m <span class="token operator">*</span>Member<span class="token punctuation">)</span> <span class="token function">UserName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">string</span><span class="token punctuation">&#123;</span>
  <span class="token keyword">if</span> m <span class="token operator">==</span> <span class="token boolean">nil</span><span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token string">""</span>
  <span class="token punctuation">&#125;</span>
  <span class="token keyword">return</span> m<span class="token punctuation">.</span>UserName
<span class="token punctuation">&#125;</span></code></pre><h4 id="make预分配长度"><a href="#make预分配长度" class="headerlink" title="make预分配长度"></a><strong>make预分配长度</strong></h4><p>在进行make内存分配时，尽可能指定容器容量，以便为容器预先分配内存</p><p><strong>Bad</strong></p><pre class="language-go" data-language="go"><code class="language-go"><span class="token keyword">func</span> <span class="token function">foo</span><span class="token punctuation">(</span>list <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">int</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">var</span> res <span class="token operator">=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
  <span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> item<span class="token operator">:=</span><span class="token keyword">range</span> list<span class="token punctuation">&#123;</span>
    <span class="token keyword">if</span> item <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">&#123;</span>
      <span class="token keyword">continue</span>
    <span class="token punctuation">&#125;</span>
    res <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>res<span class="token punctuation">,</span> item<span class="token punctuation">)</span> <span class="token comment">// append 函数会存在大量的内存拷贝</span>
  <span class="token punctuation">&#125;</span>
  <span class="token keyword">return</span> res
<span class="token punctuation">&#125;</span></code></pre><p><strong>Good</strong></p><pre class="language-go" data-language="go"><code class="language-go"><span class="token keyword">func</span> <span class="token function">foo</span><span class="token punctuation">(</span>list <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">int</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">var</span> res <span class="token operator">=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">,</span> <span class="token number">0</span> <span class="token punctuation">,</span><span class="token function">len</span><span class="token punctuation">(</span>list<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> item<span class="token operator">:=</span><span class="token keyword">range</span> list<span class="token punctuation">&#123;</span>
    <span class="token keyword">if</span> item <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">&#123;</span>
      <span class="token keyword">continue</span>
    <span class="token punctuation">&#125;</span>
    res <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>res<span class="token punctuation">,</span> item<span class="token punctuation">)</span>
  <span class="token punctuation">&#125;</span>
  <span class="token keyword">return</span> res
<span class="token punctuation">&#125;</span></code></pre><h4 id="禁止重复释放channel"><a href="#禁止重复释放channel" class="headerlink" title="禁止重复释放channel"></a><strong>禁止重复释放channel</strong></h4><p>重复释放一般存在于异常流程判断中，如果恶意攻击者构造出异常条件使程序重复释放channel，则会触发运行时panic，从而造成DoS攻击。</p><p><strong>Bad</strong></p><pre class="language-go" data-language="go"><code class="language-go"><span class="token keyword">func</span> <span class="token function">foo</span><span class="token punctuation">(</span>c <span class="token keyword">chan</span> <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
	<span class="token keyword">defer</span> <span class="token function">close</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span>
	err <span class="token operator">:=</span> <span class="token function">processBusiness</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">&#123;</span>
		c <span class="token operator">&lt;-</span> <span class="token number">0</span>
		<span class="token function">close</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span> <span class="token comment">// 重复释放channel</span>
		<span class="token keyword">return</span>
	<span class="token punctuation">&#125;</span>
	c <span class="token operator">&lt;-</span> <span class="token number">1</span>
<span class="token punctuation">&#125;</span></code></pre><p><strong>Good</strong></p><pre class="language-go" data-language="go"><code class="language-go"><span class="token keyword">func</span> <span class="token function">foo</span><span class="token punctuation">(</span>c <span class="token keyword">chan</span> <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
	<span class="token keyword">defer</span> <span class="token function">close</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span> <span class="token comment">// 使用defer延迟关闭channel</span>
	err <span class="token operator">:=</span> <span class="token function">processBusiness</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">&#123;</span>
		c <span class="token operator">&lt;-</span> <span class="token number">0</span>
		<span class="token keyword">return</span>
	<span class="token punctuation">&#125;</span>
	c <span class="token operator">&lt;-</span> <span class="token number">1</span>
<span class="token punctuation">&#125;</span></code></pre><h4 id="确保每个协程都能退出"><a href="#确保每个协程都能退出" class="headerlink" title="确保每个协程都能退出"></a><strong>确保每个协程都能退出</strong></h4><p>启动一个协程就会做一个入栈操作，在系统不退出的情况下，协程也没有设置退出条件，则相当于协程失去了控制，它占用的资源无法回收，可能会导致内存泄露。</p><pre class="language-none"><code class="language-none">&#x2F;&#x2F; bad: 协程没有设置退出条件
func doWaiter(name string, second int) &#123;
	for &#123;
		time.Sleep(time.Duration(second) * time.Second)
		fmt.Println(name, &quot; is ready!&quot;)
	&#125;
&#125;</code></pre><h3 id="推荐-1"><a href="#推荐-1" class="headerlink" title="推荐"></a><strong>推荐</strong></h3><h4 id="不使用unsafe包"><a href="#不使用unsafe包" class="headerlink" title="不使用unsafe包"></a><strong>不使用unsafe包</strong></h4><p>由于unsafe包绕过了 Golang 的内存安全原则，一般来说使用该库是不安全的，可导致内存破坏，尽量避免使用该包。若必须要使用unsafe操作指针，必须做好安全校验。</p><pre class="language-none"><code class="language-none">&#x2F;&#x2F; bad: 通过unsafe操作原始指针
func unsafePointer() &#123;
	b :&#x3D; make([]byte, 1)
	foo :&#x3D; (*int)(unsafe.Pointer(uintptr(unsafe.Pointer(&amp;b[0])) + uintptr(0xfffffffe)))
	fmt.Print(*foo + 1)
&#125;</code></pre><h2 id="字符串"><a href="#字符串" class="headerlink" title="字符串"></a><strong>字符串</strong></h2><h3 id="强制-2"><a href="#强制-2" class="headerlink" title="强制"></a><strong>强制</strong></h3><h4 id="字符串拼接"><a href="#字符串拼接" class="headerlink" title="字符串拼接"></a><strong>字符串拼接</strong></h4><p>禁止使用+号进行字符串拼接操作，如果需要使用请使用 strings.Builder</p><p><strong>Bad</strong></p><pre class="language-go" data-language="go"><code class="language-go"><span class="token keyword">for</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
  <span class="token keyword">var</span> str1 <span class="token operator">=</span> <span class="token string">"str1"</span>
  <span class="token keyword">var</span> str2 <span class="token operator">=</span> <span class="token string">"str2"</span>
  fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>str1<span class="token operator">+</span>str2<span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span></code></pre><p><strong>Good</strong></p><pre class="language-go" data-language="go"><code class="language-go"><span class="token keyword">for</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
  <span class="token keyword">var</span> str1 <span class="token operator">=</span> <span class="token string">"str1"</span>
  <span class="token keyword">var</span> str2 <span class="token operator">=</span> <span class="token string">"str2"</span>
  <span class="token keyword">var</span> str3 strings<span class="token punctuation">.</span>Builder
  str3<span class="token punctuation">.</span><span class="token function">Grow</span><span class="token punctuation">(</span><span class="token function">len</span><span class="token punctuation">(</span>str1<span class="token punctuation">)</span><span class="token operator">+</span><span class="token function">len</span><span class="token punctuation">(</span>str2<span class="token punctuation">)</span><span class="token punctuation">)</span>
  str3<span class="token punctuation">.</span><span class="token function">WriteString</span><span class="token punctuation">(</span>str1<span class="token punctuation">)</span>
  str3<span class="token punctuation">.</span><span class="token function">WriteString</span><span class="token punctuation">(</span>str2<span class="token punctuation">)</span>
  fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>str3<span class="token punctuation">.</span><span class="token function">String</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span></code></pre><h4 id="取字符串的某个字符"><a href="#取字符串的某个字符" class="headerlink" title="取字符串的某个字符"></a><strong>取字符串的某个字符</strong></h4><p>如果需要取字符串的某个字符，除非非常确定字符串中只含有ANSCII的字符，否则都必须将string转为[]rune类型</p><p><strong>Bad</strong></p><pre class="language-go" data-language="go"><code class="language-go"><span class="token keyword">var</span> str <span class="token builtin">string</span> <span class="token operator">=</span> <span class="token string">"你好"</span>
<span class="token keyword">var</span> firstChar <span class="token operator">=</span> str<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span></code></pre><p><strong>Good</strong></p><pre class="language-go" data-language="go"><code class="language-go"><span class="token keyword">var</span> str <span class="token builtin">string</span> <span class="token operator">=</span> <span class="token string">"你好"</span>
<span class="token keyword">var</span> firstChar <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">rune</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span></code></pre><h4 id="禁止使用fmt进行类型转化"><a href="#禁止使用fmt进行类型转化" class="headerlink" title="禁止使用fmt进行类型转化"></a><strong>禁止使用fmt进行类型转化</strong></h4><p>如果要将 int64、float等数字类型转化为string的话，禁止使用fmt.Sprintf进行类型转化，它的内部使用反射判断类型，性能相对较差</p><p><strong>Bad</strong></p><pre class="language-go" data-language="go"><code class="language-go"><span class="token keyword">var</span> str <span class="token builtin">string</span>
<span class="token keyword">var</span> num  <span class="token operator">=</span><span class="token number">10</span>
str <span class="token operator">=</span> fmt<span class="token punctuation">.</span><span class="token function">Sprintf</span><span class="token punctuation">(</span><span class="token string">"%v"</span><span class="token punctuation">,</span>num<span class="token punctuation">)</span></code></pre><p><strong>Good</strong></p><pre class="language-go" data-language="go"><code class="language-go"><span class="token keyword">var</span> str <span class="token builtin">string</span>
<span class="token keyword">var</span> num  <span class="token operator">=</span><span class="token number">10</span>
str <span class="token operator">=</span> strconv<span class="token punctuation">.</span><span class="token function">Itoa</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span></code></pre><h3 id="推荐-2"><a href="#推荐-2" class="headerlink" title="推荐"></a><strong>推荐</strong></h3><h4 id="cast包"><a href="#cast包" class="headerlink" title="cast包"></a><strong>cast包</strong></h4><p>可以尝试使用cast包进行类型的转化</p><pre class="language-none"><code class="language-none">cast.ToString()</code></pre><h4 id="避免反复类型转化"><a href="#避免反复类型转化" class="headerlink" title="避免反复类型转化"></a><strong>避免反复类型转化</strong></h4><p>不要反复从固定字符串创建字节切片。</p><p><strong>Bad</strong></p><pre class="language-go" data-language="go"><code class="language-go"><span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> b<span class="token punctuation">.</span>N<span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">&#123;</span>
  w<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">byte</span><span class="token punctuation">(</span><span class="token string">"Hello world"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span></code></pre><p>BenchmarkBad-4 50000000 22.2 ns/op</p><p><strong>Good</strong></p><pre class="language-go" data-language="go"><code class="language-go">data <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">byte</span><span class="token punctuation">(</span><span class="token string">"Hello world"</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> b<span class="token punctuation">.</span>N<span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">&#123;</span>
  w<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span></code></pre><p>BenchmarkGood-4 500000000 3.25 ns/op</p><h4 id="zero-copy"><a href="#zero-copy" class="headerlink" title="zero copy"></a><strong>zero copy</strong></h4><p>对于明确只做使用而不做修改的[]byte转string的功能可以使用 stringx.ZeroCopyBytes2String 函数</p><h2 id="异常处理"><a href="#异常处理" class="headerlink" title="异常处理"></a><strong>异常处理</strong></h2><h3 id="强制-3"><a href="#强制-3" class="headerlink" title="强制"></a><strong>强制</strong></h3><h4 id="协程中一定要recover"><a href="#协程中一定要recover" class="headerlink" title="协程中一定要recover"></a><strong>协程中一定要</strong>recover</h4><p>在协程中处理一定要recover掉panic，否则会导致整个进程都退出，并且要尽可能的打印全崩溃信息</p><pre class="language-none"><code class="language-none">&#x2F;&#x2F; good
func foo(f func())&#123;
  go func() &#123;
		defer func() &#123;
			if err :&#x3D; recover(); err !&#x3D; nil &#123;
        buf :&#x3D; debug.Stack()
				logrus.Errorf(&quot;SafeGo.recover :%v stack:%v&quot;, err, string(buf))
			&#125;
		&#125;()
		f()
	&#125;()
&#125;

&#x2F;&#x2F; bad 
func foo(f func())&#123;
  go f()
&#125;</code></pre><h4 id="合理使用panic"><a href="#合理使用panic" class="headerlink" title="合理使用panic"></a><strong>合理使用panic</strong></h4><p>如果问题可以被屏蔽或者被解决，那么最好让程序继续运行，比如说在某个接口中因为客户端传入了某种特殊值导致崩溃的话最好使用 recover 兜住，但是针对于某些库不能正常工作并且程序就无法继续运行的情况下，最好就Panic出去。比如说数据库连接不上、某些重要配置未配置</p><pre class="language-none"><code class="language-none">var stage &#x3D; os.Getenv(&quot;STAGE&quot;)

func init()&#123;
  if stage &#x3D;&#x3D; &quot;&quot;&#123;
    panic(&quot;no value for $STAGE&quot;)
  &#125;
&#125;</code></pre><h3 id="推荐-3"><a href="#推荐-3" class="headerlink" title="推荐"></a><strong>推荐</strong></h3><h4 id="崩溃信息统计"><a href="#崩溃信息统计" class="headerlink" title="崩溃信息统计"></a><strong>崩溃信息统计</strong></h4><p>崩溃的信息最好能够上报到Prometheus或者直接发到钉钉中</p><h4 id="error处理"><a href="#error处理" class="headerlink" title="error处理"></a><strong>error处理</strong></h4><p>可以使用 errors 包来处理异常，具体使用方法见</p><h2 id="时间日期"><a href="#时间日期" class="headerlink" title="时间日期"></a><strong>时间日期</strong></h2><h3 id="强制-4"><a href="#强制-4" class="headerlink" title="强制"></a><strong>强制</strong></h3><ol><li>不要在程序中写死一年为365天，一个月为30天，避免在闰年等情况下出现逻辑错误</li><li>禁止使用 time.Now() 来获取当前时间，获取的时间为系统默认时区，在Format时间时会出现异常</li><li>不要给前端、客户端返回字符串形式的时间类型，也不要接受它们的字符串形式的时间类型，在进行时间类型传输时一律使用秒级时间戳进行通信</li><li>必须使用 time.Duration代表某个时间段，禁止直接采用魔法数字来代表时间段。</li></ol><h3 id="推荐-4"><a href="#推荐-4" class="headerlink" title="推荐"></a><strong>推荐</strong></h3><ol><li>建议使用 live_server 的 region 库来代替某些时间函数</li><li>对于以周的时间维度划分最好使用ISO周，否则在某周跨年时会出现异常，比如说需要判断某一天是今年的第几周</li><li>如果在某些配置文件中需要配置时间段的话，建议统一采用秒数，或者在程序、配置文件中明确时间单位。</li></ol><h2 id="控制语句"><a href="#控制语句" class="headerlink" title="控制语句"></a>控<strong>制语句</strong></h2><h3 id="强制-5"><a href="#强制-5" class="headerlink" title="强制"></a><strong>强制</strong></h3><ol><li>在高并发场景时，避免使用 “等于” 判断作为中断或者退出的条件。这是因为如果并发处理没有控制好的情况下，可能值会出现值被“击穿”的情况，最好使用大于、小于的区间判断来代替</li></ol><h3 id="推荐-5"><a href="#推荐-5" class="headerlink" title="推荐"></a><strong>推荐</strong></h3><ol><li>表达异常的分支时，少用if-else语句，这种方式可以改为</li></ol><div class="table-container"><table><thead><tr><th>Bad</th><th>Good</th></tr></thead><tbody><tr><td><code>if condition &#123; return err &#125; else &#123; // 这里写else的代码 &#125;</code></td><td><code>if condition &#123; return err &#125; // 这里写else的代码</code></td></tr></tbody></table></div><ol><li>尽量避免采用取反逻辑</li></ol><h2 id="SQL操作"><a href="#SQL操作" class="headerlink" title="SQL操作"></a><strong>SQL操作</strong></h2><h3 id="强制-6"><a href="#强制-6" class="headerlink" title="强制"></a><strong>强制</strong></h3><ol><li>SQL语句默认使用预编译并绑定变量</li><li>禁止拼接SQL语句，对于传入的参数用于order by或者表名等必须通过校验</li></ol><h3 id="推荐-6"><a href="#推荐-6" class="headerlink" title="推荐"></a><strong>推荐</strong></h3><ol><li>最好使用 gorm.io 库，尽量避免使用自封装的库</li><li>在对sql进行加锁时，要注意锁的顺序，避免死锁</li><li>最好使用 deleted_at 来做软删除，除非是明确的不重要可删除的数据才真正删除</li></ol><h2 id="程序结构"><a href="#程序结构" class="headerlink" title="程序结构"></a><strong>程序结构</strong></h2><h3 id="强制-7"><a href="#强制-7" class="headerlink" title="强制"></a><strong>强制</strong></h3><ol><li>代码的每一层结构都必须有一个地方接受Context，可以放在函数中也可以放在结构体中，但是放在结构体中时务必保证每次使用结构体都初始化。</li><li>在引入一个新的代码库依赖时必须保证它的子依赖对现有的的仓库不会有影响。</li><li>禁止引入非稳定、未经过测试的代码库。</li><li><strong>核心代码、公共common库应该做到测试全复盖</strong></li></ol><h3 id="推荐-7"><a href="#推荐-7" class="headerlink" title="推荐"></a><strong>推荐</strong></h3><ol><li>避免使用init函数。尽可能的使用显式调用</li><li>当函数存在可选项时，可以使用Option模式进行优化</li><li>尽量减少大括号的嵌套。这会严重影响代码的可读性，以及增加了不必要的复杂度</li></ol><h2 id="日志"><a href="#日志" class="headerlink" title="日志"></a><strong>日志</strong></h2><h3 id="强制-8"><a href="#强制-8" class="headerlink" title="强制"></a><strong>强制</strong></h3><ol><li>禁止使用 fmt、自行书写的logger库来打印日志。日志打印一定要使用 logurs 库。同时在生成logrus.Entry结构时需要携带上ctx参数。</li><li>对于敏感操作必须要打印一条日志代表玩家操作过。比如说玩家修改自己的密码。</li><li>强制使用日志分级。分为四个等级：debug、info、warn、error</li><li>正式环境禁止打印debug日志</li><li>logrus强制使用 JSON Format</li></ol><h3 id="推荐-8"><a href="#推荐-8" class="headerlink" title="推荐"></a><strong>推荐</strong></h3><ol><li>谨慎地记录日志。生产环境禁止输出 debug 日志;有选择地输出 info 日志</li><li>可以使用warn日志级别来记录用户输入参数错误的情况，如非必要，请不要在此场景打印 error 级别日志</li></ol><h1 id="服务"><a href="#服务" class="headerlink" title="服务"></a><strong>服务</strong></h1><h2 id="强制-9"><a href="#强制-9" class="headerlink" title="强制"></a><strong>强制</strong></h2><ol><li>用户请求传入的任何参数必须做有效性验证</li><li>用户输入的SQL参数严格使用参数绑定。防止sql注入、拼接sql字符串访问数据库。对于string类型的参数应该格外注意</li><li>对于暴露在外部的接口严格使用<code>$&#123;serverName&#125;/$&#123;type&#125;/$&#123;version&#125;/*</code> 。其中<code>$&#123;serverName&#125;</code> 为 项目名。<code>$&#123;type&#125;</code> 限定三个类型：app代表暴露在app端的接口， rpc代表rpc接口，backend代表后台接口。<code>$&#123;version&#125;</code> 代表接口版本。</li><li>暴露在外的接口要做玩家token验证。</li><li>隶属于用户个人的页面或者功能必须进行权限控制校验</li><li>用户敏感数据禁止直接展示，必须对数据进行脱敏</li></ol><h2 id="推荐-9"><a href="#推荐-9" class="headerlink" title="推荐"></a><strong>推荐</strong></h2><ol><li>发贴、评论、发送即时消息等用户生成内容的场景需实现防刷、文本内容违禁词过滤等风控策略。</li><li>消息队列如果存在很大的吞吐量且允许部分消息丢失则最好使用Kafka。</li><li>RabbitMQ适用于重要消息，在接入RabbitMQ时最好</li></ol></div><div class="reward-container"><div>请用钱砸死我！！！</div><button onclick='var qr=document.getElementById("qr");qr.style.display="none"===qr.style.display?"block":"none"'>打赏</button><div id="qr" style="display:none"><div style="display:inline-block"><img src="https://img.helloteemo.com.cn/wechatpay.png" alt="芒果zzZ 微信支付"><p>微信支付</p></div><div style="display:inline-block"><img src="https://img.helloteemo.com.cn/alipay.png" alt="芒果zzZ 支付宝"><p>支付宝</p></div></div></div><footer class="post-footer"><div class="post-tags"><a href="/tags/go/" rel="tag"># go</a></div><div class="post-nav"><div class="post-nav-item"><a href="/2023/09/22/%E4%B8%8D%E7%9F%A5%E9%81%93%E6%80%8E%E4%B9%88%E5%88%86%E7%B1%BB/%E9%9D%A2%E8%AF%95%E6%99%BA%E5%8A%9B%E9%A2%98/" rel="prev" title="面试智力题"><i class="fa fa-chevron-left"></i> 面试智力题</a></div><div class="post-nav-item"><a href="/2025/02/10/Golang/gRPC%E5%9C%A8%E9%A1%B9%E7%9B%AE%E4%B8%AD%E7%9A%84%E8%BF%90%E7%94%A8/" rel="next" title="gRPC在项目中的运用">gRPC在项目中的运用 <i class="fa fa-chevron-right"></i></a></div></div></footer></article></div><div class="comments" id="gitalk-container"></div><script>window.addEventListener("tabs:register",()=>{let{activeClass:t}=CONFIG.comments;if(CONFIG.comments.storage&&(t=localStorage.getItem("comments_active")||t),t){let e=document.querySelector(`a[href="#comment-${t}"]`);e&&e.click()}}),CONFIG.comments.storage&&window.addEventListener("tabs:click",t=>{if(!t.target.matches(".tabs-comment .tab-content .tab-pane"))return;let e=t.target.classList[1];localStorage.setItem("comments_active",e)})</script></div><div class="toggle sidebar-toggle"><span class="toggle-line toggle-line-first"></span> <span class="toggle-line toggle-line-middle"></span> <span class="toggle-line toggle-line-last"></span></div><aside class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc">文章目录</li><li class="sidebar-nav-overview">站点概览</li></ul><div class="post-toc-wrap sidebar-panel"><div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%89%8D%E8%A8%80"><span class="nav-number">1.</span> <span class="nav-text">前言</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E9%80%9A%E7%94%A8"><span class="nav-number">2.</span> <span class="nav-text">通用</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%B3%A8%E9%87%8A"><span class="nav-number">2.1.</span> <span class="nav-text">注释</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%BC%BA%E5%88%B6"><span class="nav-number">2.1.1.</span> <span class="nav-text">强制</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%8E%A8%E8%8D%90"><span class="nav-number">2.1.2.</span> <span class="nav-text">推荐</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86"><span class="nav-number">2.2.</span> <span class="nav-text">内存管理</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%BC%BA%E5%88%B6-1"><span class="nav-number">2.2.1.</span> <span class="nav-text">强制</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%88%87%E7%89%87%E9%95%BF%E5%BA%A6%E6%A0%A1%E9%AA%8C"><span class="nav-number">2.2.1.1.</span> <span class="nav-text">切片长度校验</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#nil%E6%8C%87%E9%92%88%E5%88%A4%E7%A9%BA"><span class="nav-number">2.2.1.2.</span> <span class="nav-text">nil指针判空</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#make%E9%A2%84%E5%88%86%E9%85%8D%E9%95%BF%E5%BA%A6"><span class="nav-number">2.2.1.3.</span> <span class="nav-text">make预分配长度</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%A6%81%E6%AD%A2%E9%87%8D%E5%A4%8D%E9%87%8A%E6%94%BEchannel"><span class="nav-number">2.2.1.4.</span> <span class="nav-text">禁止重复释放channel</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%A1%AE%E4%BF%9D%E6%AF%8F%E4%B8%AA%E5%8D%8F%E7%A8%8B%E9%83%BD%E8%83%BD%E9%80%80%E5%87%BA"><span class="nav-number">2.2.1.5.</span> <span class="nav-text">确保每个协程都能退出</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%8E%A8%E8%8D%90-1"><span class="nav-number">2.2.2.</span> <span class="nav-text">推荐</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%B8%8D%E4%BD%BF%E7%94%A8unsafe%E5%8C%85"><span class="nav-number">2.2.2.1.</span> <span class="nav-text">不使用unsafe包</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AD%97%E7%AC%A6%E4%B8%B2"><span class="nav-number">2.3.</span> <span class="nav-text">字符串</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%BC%BA%E5%88%B6-2"><span class="nav-number">2.3.1.</span> <span class="nav-text">强制</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%8B%BC%E6%8E%A5"><span class="nav-number">2.3.1.1.</span> <span class="nav-text">字符串拼接</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%8F%96%E5%AD%97%E7%AC%A6%E4%B8%B2%E7%9A%84%E6%9F%90%E4%B8%AA%E5%AD%97%E7%AC%A6"><span class="nav-number">2.3.1.2.</span> <span class="nav-text">取字符串的某个字符</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%A6%81%E6%AD%A2%E4%BD%BF%E7%94%A8fmt%E8%BF%9B%E8%A1%8C%E7%B1%BB%E5%9E%8B%E8%BD%AC%E5%8C%96"><span class="nav-number">2.3.1.3.</span> <span class="nav-text">禁止使用fmt进行类型转化</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%8E%A8%E8%8D%90-2"><span class="nav-number">2.3.2.</span> <span class="nav-text">推荐</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#cast%E5%8C%85"><span class="nav-number">2.3.2.1.</span> <span class="nav-text">cast包</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%81%BF%E5%85%8D%E5%8F%8D%E5%A4%8D%E7%B1%BB%E5%9E%8B%E8%BD%AC%E5%8C%96"><span class="nav-number">2.3.2.2.</span> <span class="nav-text">避免反复类型转化</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#zero-copy"><span class="nav-number">2.3.2.3.</span> <span class="nav-text">zero copy</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86"><span class="nav-number">2.4.</span> <span class="nav-text">异常处理</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%BC%BA%E5%88%B6-3"><span class="nav-number">2.4.1.</span> <span class="nav-text">强制</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%8D%8F%E7%A8%8B%E4%B8%AD%E4%B8%80%E5%AE%9A%E8%A6%81recover"><span class="nav-number">2.4.1.1.</span> <span class="nav-text">协程中一定要recover</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%90%88%E7%90%86%E4%BD%BF%E7%94%A8panic"><span class="nav-number">2.4.1.2.</span> <span class="nav-text">合理使用panic</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%8E%A8%E8%8D%90-3"><span class="nav-number">2.4.2.</span> <span class="nav-text">推荐</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%B4%A9%E6%BA%83%E4%BF%A1%E6%81%AF%E7%BB%9F%E8%AE%A1"><span class="nav-number">2.4.2.1.</span> <span class="nav-text">崩溃信息统计</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#error%E5%A4%84%E7%90%86"><span class="nav-number">2.4.2.2.</span> <span class="nav-text">error处理</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%97%B6%E9%97%B4%E6%97%A5%E6%9C%9F"><span class="nav-number">2.5.</span> <span class="nav-text">时间日期</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%BC%BA%E5%88%B6-4"><span class="nav-number">2.5.1.</span> <span class="nav-text">强制</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%8E%A8%E8%8D%90-4"><span class="nav-number">2.5.2.</span> <span class="nav-text">推荐</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%8E%A7%E5%88%B6%E8%AF%AD%E5%8F%A5"><span class="nav-number">2.6.</span> <span class="nav-text">控制语句</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%BC%BA%E5%88%B6-5"><span class="nav-number">2.6.1.</span> <span class="nav-text">强制</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%8E%A8%E8%8D%90-5"><span class="nav-number">2.6.2.</span> <span class="nav-text">推荐</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#SQL%E6%93%8D%E4%BD%9C"><span class="nav-number">2.7.</span> <span class="nav-text">SQL操作</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%BC%BA%E5%88%B6-6"><span class="nav-number">2.7.1.</span> <span class="nav-text">强制</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%8E%A8%E8%8D%90-6"><span class="nav-number">2.7.2.</span> <span class="nav-text">推荐</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%A8%8B%E5%BA%8F%E7%BB%93%E6%9E%84"><span class="nav-number">2.8.</span> <span class="nav-text">程序结构</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%BC%BA%E5%88%B6-7"><span class="nav-number">2.8.1.</span> <span class="nav-text">强制</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%8E%A8%E8%8D%90-7"><span class="nav-number">2.8.2.</span> <span class="nav-text">推荐</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%97%A5%E5%BF%97"><span class="nav-number">2.9.</span> <span class="nav-text">日志</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%BC%BA%E5%88%B6-8"><span class="nav-number">2.9.1.</span> <span class="nav-text">强制</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%8E%A8%E8%8D%90-8"><span class="nav-number">2.9.2.</span> <span class="nav-text">推荐</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%9C%8D%E5%8A%A1"><span class="nav-number">3.</span> <span class="nav-text">服务</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%BC%BA%E5%88%B6-9"><span class="nav-number">3.1.</span> <span class="nav-text">强制</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%8E%A8%E8%8D%90-9"><span class="nav-number">3.2.</span> <span class="nav-text">推荐</span></a></li></ol></li></ol></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="site-author-image" itemprop="image" alt="芒果zzZ" src="https://img.helloteemo.com.cn/logo.png"><p class="site-author-name" itemprop="name">芒果zzZ</p><div class="site-description" itemprop="description">纵有风花雪月又如何</div></div><div class="site-state-wrap motion-element"><nav class="site-state"><div class="site-state-item site-state-posts"><a href="/archives/"><span class="site-state-item-count">62</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"><a href="/categories/"><span class="site-state-item-count">23</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"><a href="/tags/"><span class="site-state-item-count">22</span> <span class="site-state-item-name">标签</span></a></div></nav></div><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="https://github.com/helloteemo" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;helloteemo" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i>GitHub</a> </span><span class="links-of-author-item"><a href="mailto:zhukewei1998@gmail.com" title="E-Mail → mailto:zhukewei1998@gmail.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i>E-Mail</a></span></div><div class="links-of-blogroll motion-element"><div class="links-of-blogroll-title"><i class="fa fa-fw fa-link"></i> Links</div><ul class="links-of-blogroll-list"><li class="links-of-blogroll-item"><a href="https://www.gkshi.com/" title="https:&#x2F;&#x2F;www.gkshi.com&#x2F;" rel="noopener" target="_blank">gkshi的小站</a></li><li class="links-of-blogroll-item"><a href="https://zhouxuwen.github.io/" title="https:&#x2F;&#x2F;zhouxuwen.github.io&#x2F;" rel="noopener" target="_blank">zxw的小破站</a></li><li class="links-of-blogroll-item"><a href="https://sicuni.github.io/" title="https:&#x2F;&#x2F;sicuni.github.io&#x2F;" rel="noopener" target="_blank">sicuni的站点</a></li></ul></div></div><div class="back-to-top motion-element"><i class="fa fa-arrow-up"></i> <span>0%</span></div></div></aside><div id="sidebar-dimmer"></div></div></main><footer class="footer"><div class="footer-inner"><div class="beian"><a href="http://www.beian.miit.gov.cn/" rel="noopener" target="_blank">赣ICP备20008539号</a></div><div class="copyright">&copy; 2020 – <span itemprop="copyrightYear">2025</span> <span class="with-love"><i class="fa fa-user"></i> </span><span class="author" itemprop="copyrightHolder">芒果zzZ</span> <span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-area-chart"></i> </span><span title="站点总字数">137k</span> <span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-coffee"></i> </span><span title="站点阅读时长">2:05</span></div><br><span id="timeDate">载入天数...</span> <span id="times">载入时分秒...</span><script>var now=new Date;function createtime(){var n=new Date("09/21/2020 15:54:40");now.setTime(now.getTime()+250),days=(now-n)/1e3/60/60/24,dnum=Math.floor(days),hours=(now-n)/1e3/60/60-24*dnum,hnum=Math.floor(hours),1==String(hnum).length&&(hnum="0"+hnum),minutes=(now-n)/1e3/60-1440*dnum-60*hnum,mnum=Math.floor(minutes),1==String(mnum).length&&(mnum="0"+mnum),seconds=(now-n)/1e3-86400*dnum-3600*hnum-60*mnum,snum=Math.round(seconds),1==String(snum).length&&(snum="0"+snum),document.getElementById("timeDate").innerHTML="本站已安全运行 "+dnum+" 天 ",document.getElementById("times").innerHTML=hnum+" 小时 "+mnum+" 分 "+snum+" 秒"}setInterval("createtime()",250)</script><div class="busuanzi-count"><script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span class="post-meta-item" id="busuanzi_container_site_uv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-user"></i> </span><span class="site-uv" title="总访客量"><span id="busuanzi_value_site_uv"></span> </span></span><span class="post-meta-divider">|</span> <span class="post-meta-item" id="busuanzi_container_site_pv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-eye"></i> </span><span class="site-pv" title="总访问量"><span id="busuanzi_value_site_pv"></span></span></span></div></div></footer></div><script src="/lib/anime.min.js"></script><script src="/lib/velocity/velocity.min.js"></script><script src="/lib/velocity/velocity.ui.min.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/pisces.js"></script><script src="/js/next-boot.js"></script><script src="/js/bookmark.js"></script><script>!function(){var t=document.createElement("script"),e=window.location.protocol.split(":")[0];t.src="https"===e?"https://zz.bdstatic.com/linksubmit/push.js":"http://push.zhanzhang.baidu.com/push.js";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(t,s)}()</script><script src="/js/local-search.js"></script><script>document.querySelectorAll("pre.mermaid").length&&NexT.utils.getScript("//cdn.jsdelivr.net/npm/mermaid@8/dist/mermaid.min.js",()=>{mermaid.initialize({theme:"forest",logLevel:3,flowchart:{curve:"linear"},gantt:{axisFormat:"%m/%d/%Y"},sequence:{actorMargin:50}})},window.mermaid)</script><script src="//cdn.jsdelivr.net/npm/quicklink@1/dist/quicklink.umd.js"></script><script>window.addEventListener("load",()=>{quicklink({timeout:3e3,priority:!0,ignores:[i=>i.includes("#"),i=>"https://helloteemo.github.io/2025/02/10/Golang/Go%E4%B9%A6%E5%86%99%E5%BB%BA%E8%AE%AE/"===i]})})</script><link rel="stylesheet" href="//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.css"><script>NexT.utils.loadComments(document.querySelector("#gitalk-container"),()=>{NexT.utils.getScript("//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js",()=>{new Gitalk({clientID:"b0b6e2613d61bb99e835",clientSecret:"50a2d0e2f5dbf4ead8968013003a0557d0076283",repo:"helloteemo.github.io",owner:"helloteemo",admin:["helloteemo"],id:"083017a11841995cbdb008a24a51205d",language:"zh-CN",distractionFreeMode:!0}).render("gitalk-container")},window.Gitalk)})</script></body></html>